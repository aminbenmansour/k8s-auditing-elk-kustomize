# poc-k8s-auditing-kustomize
Sample configuration to apply Kubernetes Auditing with Kustomize.
This configuration is tested on `apiserver` manifests that have been generated by `Kubespray v2.28` for a HA Kubernetes cluster.

This repo also sets up a log aggregation and visualization solution on the ELK stack for the following resources:
* Audit logs.
* Kubelet logs.
* Pod (Workloads) logs.

# Usage
**Pre-requisites:** Change *apiserver-patch/variables.yaml* to your relevent values for your cluster.
1. Enable audit logging for all control planes.
  * **generate-audit.sh**: generate new *kube-apiserver.yaml* for all control planes and places them under `apiserver-patch/manifests`.
  * **deploy-audit.sh**: updates control plane nodes with audit configuration.
```bash
cd apiserver-patch/scripts && ./generate-audit.sh && ./deploy-audit.sh && cd ../..
```

2. Enable ELK stack
**Pre-requisites:** The machine that executes these scripts should have access to the Kubernetes cluster (`KUBECONFIG`) and have `helm` installed!
```bash
cd observability && ./helm-elk-stack.sh && cd ..
```

# Conclusion
Cheers! We have the swiss army knife of gathering and vizualizing logs from multiple sources!
